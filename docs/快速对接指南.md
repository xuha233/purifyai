# 快速对接指南

> 本指南帮助技术对接方快速了解和接入 PurifyAI 项目

## 入口文档顺序

1. **README.md** - 项目快速了解（5分钟）
2. **目录结构.md** - 项目结构了解（10分钟）
3. **技术档案.md** - 完整技术细节（30分钟）

## 快速开始对接

### 环境准备

```bash
# Python环境
python --version  # 需要Python 3.14+

# 进入项目目录
cd G:\docker\diskclean\src

# 安装依赖
pip install -r ../requirements.txt
```

### 核心模块速查

#### 扫描操作

```python
from core import get_scanner
from core.models import ScanItem
from core.config_manager import get_config_manager

# 获取扫描器
scanner = SystemScanner()

# 连接信号
scanner.item_found.connect(lambda item: print(f"发现: {item.path}"))
scanner.complete.connect(lambda items: print(f"完成，共{len(items)}项"))

# 扫描
scanner.scan('system')
```

#### 清理操作

```python
from core import Cleaner

# 获取清理器
cleaner = Cleaner()

# 清理文件
cleaner.clean([item1, item2], clean_type='system')
```

#### 配置读取

```python
from core.config_manager import get_config_manager

config = get_config_manager()
enabled = config.get('notification/enabled', True)
```

#### 数据库操作

```python
from core.database import get_database

db = get_database()
history = db.get_cleanup_history(limit=10)
```

## 关键类简表

| 模块 | 类名 | 文件 | 功能 |
|------|------|------|------|
| 核心 | `PurifyAIApp` | `app.py` | 主应用类 |
| 扫描 | `SystemScanner` | `core/scanner.py` | 系统扫描器 |
| 扫描 | `BrowserScanner` | `core/scanner.py` | 浏览器扫描器 |
| 扫描 | `AppDataScanner` | `core/scanner.py` | AppData扫描器 |
| 清理 | `Cleaner` | `core/cleaner.py` | 清理器 |
| 规则 | `RuleEngine` | `core/rule_engine.py` | 规则引擎 |
| 配置 | `ConfigManager` | `core/config_manager.py` | 配置管理器 |
| 数据库 | `Database` | `core/database.py` | 数据库操作 |
| 迁移 | `AppDataMigrationTool` | `core/appdata_migration.py` | 迁移工具 |

## 常用代码片段

### 获取所有扫描器

```python
from core import SystemScanner, BrowserScanner, AppDataScanner, CustomScanner

scanners = {
    'system': SystemScanner(),
    'browser': BrowserScanner(),
    'appdata': AppDataScanner(),
    'custom': CustomScanner(),
}
```

### 获取配置

```python
from core.config_manager import get_config_manager

config = get_config_manager()
notif = config.get('notification/enabled')
tray = config.get('system_tray/enabled')
ai = config.get_ai_config()
migration = config.get('appdata_migration/enabled')
```

### 检查权限

```python
from core.permissions import is_admin, request_admin_privilege

if not is_admin():
    request_admin_privilege()
```

### 格式化文件大小

```python
from core import format_size

print(format_size(1024 * 1024))  # 输出: 1.00 MB
```

## UI定制

### 主窗口大小

修改 `src/main.py` 第52行：
```python
window.resize(1100, 750)  # 可调整为任意尺寸
```

### 窗口标题

修改 `src/main.py` 第51行：
```python
window.setWindowTitle('PurifyAI - 智能清理工具')  # 自定义标题
```

### 主题颜色

通过 QFluentWidgets API 修改主题：
```python
from qfluentwidgets import setTheme, Theme

setTheme(Theme.DARK)  # 深色主题
setTheme(Theme.LIGHT)  # 浅色主题
```

## 数据库表结构

| 表名 | 说明 |
|------|------|
| cleanup_history | 清理历史记录 |
| cleaned_items | 清理项目明细 |

数据库文件：`src/data/purifyai.db`

## 风险级别

| 级别 | 值 | 颜色 | 含义 |
|------|-----|------|------|
| SAFE | 'safe' | 绿色 | 可安全删除 |
| SUSPICIOUS | 'suspicious' | 黄色 | 需用户确认 |
| DANGEROUS | 'dangerous' | 红色 | 不建议删除 |

## 扩展功能

### 添加新的扫描类型

1. 在 `src/core/scanner.py` 添加新的扫描器类
2. 继承 `QObjectScanner` 基类
3. 实现扫描逻辑
4. 在 `src/core/__init__.py` 导出

### 添加新的UI页面

1. 创建新的页面类 `src/ui/new_page.py`
2. 继承 `QWidget`
3. 在 `src/app.py` 的 `__init__` 中添加页面
4. 在导航栏添加菜单项

### 添加新的配置项

1. 在设置页面 `src/ui/settings.py` 添加UI组件
2. 在 `on_xxx_changed` 方法中保存配置
3. 使用 `config_mgr.set('new_key', value)` 保存

## 运行项目

```bash
# 基本运行
cd src
python main.py

# 带调试运行
python main.py --debug

# 查看日志
# 日志自动记录到 purifyai_errors.log
```

## 常见问题速查

| 问题 | 解决方案 |
|------|---------|
| 导入错误 | 确保 `src` 在 `sys.path` 中 |
| 扫描失败 | 检查管理员权限 |
| UI不显示 | 检查 PyQt5 和 QFluentWidgets 版本 |
| 数据库错误 | 删除数据库文件重新创建 |
| 配置不保存 | 检查文件写入权限 |

## 对接支持重点章节

技术档案.md 中的相关章节：
- 第2章：技术架构
- 第5章：核心类说明
- 第6章：数据模型
- 第7章：API接口
- 第8章：配置管理

---

**提示**: 详细技术细节请查阅 `技术档案.md`
