# PurifyAI 智能清理工具 - 技术档案

> 项目名称: PurifyAI
> 版本: v1.0
> 最后更新: 2026-02-21
> Python版本: 3.14+

---

## 目录

1. [项目概述](#1-项目概述)
2. [技术架构](#2-技术架构)
3. [目录结构](#3-目录结构)
4. [功能模块](#4-功能模块)
5. [核心类说明](#5-核心类说明)
6. [数据模型](#6-数据模型)
7. [API接口](#7-api接口)
8. [配置管理](#8-配置管理)
9. [数据库结构](#9-数据库结构)
10. [依赖清单](#10-依赖清单)
11. [安装与部署](#11-安装与部署)
12. [开发指南](#12-开发指南)
13. [测试指南](#13-测试指南)
14. [常见问题](#14-常见问题)

---

## 1. 项目概述

### 1.1 项目简介

PurifyAI 是一款基于 PyQt5 开发的 Windows 系统清理工具，集成 AI 智能评估功能，能够安全地扫描、分析和清理系统中的垃圾文件。

### 1.2 核心特性

| 特性 | 描述 |
|------|------|
| 系统扫描 | 扫描临时文件、预取文件、日志、更新缓存等 |
| 浏览器清理 | 支持 Chrome、Edge、Firefox 浏览器缓存清理 |
| AppData扫描 | 扫描用户应用数据目录，支持风险评估 |
| 自定义扫描 | 支持用户自定义扫描路径 |
| AI智能评估 | 基于规则的文件风险智能评估 |
| 风险分级 | SAFE / SUSPICIOUS / DANGEROUS 三级风险划分 |
| 系统托盘 | 支持最小化到托盘，后台运行 |
| 自动清理 | 支持定时清理和磁盘空间阈值触发 |
| 回收功能 | 可选的系统回收站功能 |
| AppData迁移 | 支持将大型AppData文件夹迁移到其他磁盘 |

### 1.3 技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| Python | 3.14+ | 核心开发语言 |
| PyQt5 | 5.15.0+ | GUI框架 |
| QFluentWidgets | 1.0.0+ | Fluent设计UI组件 |
| psutil | 5.9.0+ | 系统监控和进程管理 |
| send2trash | 1.8.0+ | 安全删除文件 |
| SQLite3 | 内置 | 数据库存储 |

---

## 2. 技术架构

### 2.1 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      PurifyAI 主应用                        │
│                       (app.py)                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌───────────────┐  │
│  │ 系统托盘      │    │ 通知管理器     │    │ 调度器         │  │
│  │ SystemTray   │    │ Notification  │    │ Scheduler      │  │
│  └──────────────┘    └──────────────┘    └───────────────┘  │
│                                                              │
│  ┌──────────────────────────────┐    ┌──────────────────┐ │
│  │     核心模块 (core/)         │    │   UI模块 (ui/)   │ │
│  │  - Scanner (扫描器)          │◄──►│ - 各功能页面      │ │
│  │  - Cleaner (清理器)          │    │ - 导航栏          │ │
│  │  - RuleEngine (规则引擎)     │    │ - 对话框          │ │
│  │  - RiskAssessment (风险评估)  │    │ - 系统托盘        │ │
│  │  - AIEnhancer (AI增强)       │    │ - 通知            │ │
│  │  - AppDataMigration (迁移)    │    │ - 设置            │ │
│  └──────────────────────────────┘    └──────────────────┘ │
│              │                                           │
│              ▼                                           │
│  ┌──────────────────────────────┐    ┌──────────────────┐ │
│  │      工具模块 (utils/)        │    │ 数据层 (data/)    │ │
│  │  - Logger (日志)             │◄──►│ - SQLite数据库    │ │
│  │  - ErrorHandler (错误处理)    │    │ - 白名单配置      │ │
│  │  - DebugMonitor (调试监视)    │    │ - 用户配置        │ │
│  └──────────────────────────────┘    └──────────────────┘ │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 模块依赖关系

```
app.py (主应用)
  ├─ ui/ (UI层)
  │   ├─ dashboard.py          # 仪表板
  │   ├─ system_cleaner.py      # 系统清理页
  │   ├─ browser_cleaner.py     # 浏览器清理页
  │   ├─ custom_cleaner.py      # 自定义清理页
  │   ├─ settings.py            # 设置页
  │   ├─ history_page.py        # 历史记录页
  │   ├─ recovery_page.py       # 回收站页
  │   └─ developer_console.py  # 开发者控制台
  │
  └─ core/ (业务逻辑层)
      ├─ scanner.py            # 扫描器
      ├─ cleaner.py            # 清理器
      ├─ rule_engine.py        # 规则引擎
      ├─ risk_assessment.py   # 风险评估
      ├─ config_manager.py    # 配置管理
      ├─ database.py          # 数据库
      ├─ whitelist.py         # 白名单
      ├─ permissions.py        # 权限管理
      ├─ appdata_migration.py  # AppData迁移
      └─ ai_*.py               # AI相关模块
```

---

## 3. 目录结构

```
diskclean/
├── src/                          # 源代码目录
│   ├── main.py                   # 应用入口
│   ├── app.py                    # 主应用类
│   ├── requirements.txt           # 依赖清单
│   │
│   ├── core/                     # 核心业务模块
│   │   ├── __init__.py          # 模块导出
│   │   ├── scanner.py           # 扫描器 (系统/浏览器/AppData)
│   │   ├── cleaner.py           # 清理器
│   │   ├── models.py            # 数据模型
│   │   ├── rule_engine.py       # 规则引擎
│   │   ├── risk_assessment.py   # 风险评估系统
│   │   ├── config_manager.py    # 配置管理器
│   │   ├── database.py          # 数据库操作
│   │   ├── whitelist.py         # 白名单管理
│   │   ├── permissions.py        # 权限管理
│   │   ├── scheduler.py         # 任务调度器
│   │   ├── appdata_migration.py # AppData迁移工具
│   │   ├── ai_*.py              # AI相关模块 (6个)
│   │   ├── annotation.py        # 扫描标注
│   │   └── safety/              # 安全模块
│   │       ├── custom_recycle_bin.py  # 自定义回收站
│   │       ├── preview.py            # 预览功能
│   │       └── recovery.py           # 恢复功能
│   │
│   ├── ui/                       # UI模块
│   │   ├── dashboard.py          # 仪表板页面
│   │   ├── system_cleaner.py     # 系统清理页面
│   │   ├── browser_cleaner.py    # 浏览器清理页面
│   │   ├── custom_cleaner.py     # 自定义清理页面
│   │   ├── settings.py           # 设置页面
│   │   ├── history_page.py       # 历史记录页面
│   │   ├── recovery_page.py      # 回收站页面
│   │   ├── developer_console.py  # 开发者控制台
│   │   ├── appdata_migration_dialog.py  # 迁移对话框
│   │   ├── confirm_dialog.py     # 确认对话框
│   │   ├── scan_status_widget.py # 扫描状态组件
│   │   ├── system_tray.py        # 系统托盘
│   │   ├── windows_notification.py # Windows通知
│   │   └── whitelist_dialog.py   # 白名单管理对话框
│   │
│   ├── utils/                    # 工具模块
│   │   ├── logger.py             # 日志系统
│   │   ├── error_handler.py      # 错误处理器
│   │   ├── debug_monitor.py      # 调试监视器
│   │   └── startup.py            # 开机启动管理
│   │
│   ├── data/                     # 数据目录
│   │   └── whitelist.json        # 白名单配置
│   │
│   └── docs/                     # 文档目录
│       └── AI_REVIEW_FIX_PLAN.md
│
├── settings.json                  # 应用配置
├── requirements.txt               # Python依赖
└── 技术档案.md                    # 本文档
```

---

## 4. 功能模块

### 4.1 扫描模块 (Scanner)

#### SystemScanner - 系统扫描器

扫描系统目录中的垃圾文件：

| 扫描类型 | 路径 | 说明 |
|---------|------|------|
| 临时文件 | C:\Windows\Temp | 系统临时文件 |
| 预取文件 | C:\Windows\Prefetch | 应用程序预取缓存 |
| 日志文件 | 多个位置 | 系统和应用日志 |
| 更新缓存 | C:\Windows\SoftwareDistribution | Windows更新缓存 |

#### BrowserScanner - 浏览器扫描器

扫描浏览器缓存文件：

| 浏览器 | 支持平台 | 缓存路径 |
|--------|---------|---------|
| Chrome | Chrome/Chromium | User Data\Default\Cache |
| Edge | Chromium-based | User Data\Default\Cache |
| Firefox | Gecko | profiles\cache2 |

#### AppDataScanner - AppData扫描器

扫描用户应用数据目录：

| 扫描类型 | 路径 | 风险级别 |
|---------|------|---------|
| Roaming | %APPDATA% | 多数为配置，需谨慎 |
| Local | %LOCALAPPDATA% | 包含缓存和应用数据，规则区分 |
| LocalLow | %LOCALAPPDATA%\LocalLow | 临时数据，相对安全 |

#### CustomScanner - 自定义扫描器

支持用户指定自定义路径扫描。

### 4.2 清理模块 (Cleaner)

| 功能 | 说明 |
|------|------|
| 安全删除 | 使用 send2trash 移动到系统回收站 |
| 直接删除 | 可选永久删除（需谨慎） |
| 进程检测 | 扫描/清理前检测文件占用 |
| 权限提升 | 自动请求管理员权限（如需） |

### 4.3 风险评估模块

| 风险级别 | 说明 | 建议操作 |
|---------|------|---------|
| SAFE | 可安全删除的缓存、临时文件 | 建议清理 |
| SUSPICIOUS | 需用户确认的数据文件 | 用户确认后清理 |
| DANGEROUS | 系统关键文件、重要配置 | 不建议清理 |

### 4.4 AppData Migration 模块

将大型 AppData 文件夹迁移到其他磁盘的特性：

| 功能 | 说明 |
|------|------|
| 扫描大型文件夹 | 按大小过滤可迁移文件夹 |
| 风险评估 | 自动评估文件夹迁移风险 |
| 符号链接 | 使用 Windows mklink 创建透明重定向 |
| 迁移历史 | 记录所有迁移记录，支持回滚 |

### 4.5 配置管理 (ConfigManager)

存储于 `purifyai_config.json`：

```json
{
  "notification": {"enabled": true},
  "system_tray": {"enabled": true, "minimize": true},
  "startup": {"enabled": false},
  "cleanup": {"confirm_dialog": true},
  "scheduler": {"type": 0, "daily_time": "03:00"},
  "recycle": {"enabled": false},
  "ai": {"enabled": false, "api_url": "", "api_key": "", "api_model": ""},
  "appdata_migration": {"enabled": false},
  "developer_console": {"enabled": false}
}
```

---

## 5. 核心类说明

### 5.1 PurifyAIApp (主应用类)

文件: `src/app.py`

```python
class PurifyAIApp(QWidget):
    """PyQt GUI应用程序主类"""

    def __init__(self, app: QApplication):
        # 初始化组件
        self.navigation = NavigationInterface(self)
        self.stacked_widget = QStackedWidget(self)

        # 初始化页面
        self.dashboard_page = DashboardPage(...)
        self.system_cleaner_page = SystemCleanerPage(...)
        self.browser_cleaner_page = BrowserCleanerPage(...)
        self.custom_cleaner_page = CustomCleanerPage(...)
        self.settings_page = SettingsPage(...)
        self.history_page = HistoryPage(...)
        self.recovery_page = RecoveryPage(...)

        # 附加组件
        self.tray = SystemTray(self)
        self.notification = WindowsNotification(...)
        self.scheduler = Scheduler(...)
```

### 5.2 Scanner (扫描器基类)

文件: `src/core/scanner.py`

```python
class QObjectScanner(QObject):
    """扫描器基类 - 所有扫描器继承此类"""

    # 信号
    progress = pyqtSignal(str)  # 扫描进度
    item_found = pyqtSignal(object)  # 发现项目
    error = pyqtSignal(str)  # 错误
    complete = pyqtSignal(list)  # 完成

    def scan(self, paths: List[str], filters: List[str]):
        """执行扫描"""

    def cancel_scan(self):
        """取消扫描"""
```

### 5.3 Cleaner (清理器)

文件: `src/core/cleaner.py`

```python
class QObjectCleaner(QObject):
    """清理器"""

    # 信号
    progress = pyqtSignal(str)
    item_deleted = pyqtSignal(str, int)  # path, size
    error = pyqtSignal(str)
    complete = pyqtSignal(dict)

    def clean(self, items: List[ScanItem], clean_type: str):
        """执行清理"""

    def cancel_clean(self):
        """取消清理"""
```

### 5.4 RuleEngine (规则引擎)

文件: `src/core/rule_engine.py`

```python
class RuleEngine:
    """规则引擎 - 基于规则评估文件风险"""

    def evaluate(self, item: ScanItem) -> RuleAssessmentResult:
        """评估单个文件"""

    def evaluate_batch(self, items: List[ScanItem]) -> List[RuleAssessmentResult]:
        """批量评估"""
```

### 5.5 AppDataMigrationTool

文件: `src/core/appdata_migration.py`

```python
class AppDataMigrationTool(QObject):
    """AppData 迁移工具"""

    def scan_large_folders(self, min_size_mb: int) -> List[MigrationItem]:
        """扫描大型文件夹"""

    def migrate_folder(self, source: str, target: str) -> bool:
        """迁移文件夹并创建符号链接"""

    def rollback_migration(self, source: str, target: str) -> bool:
        """回滚迁移"""
```

### 5.6 ConfigManager (配置管理器)

文件: `src/core/config_manager.py`

```python
class ConfigManager:
    """配置管理器 - JSON格式配置文件管理"""

    def get(self, key: str, default=None):  # 获取配置
    def set(self, key: str, value):       # 设置配置
    def get_ai_config(self):              # 获取AI配置
    def set_ai_config(self, **kwargs):     # 设置AI配置
    def _load_config(self):                # 加载配置文件
    def _save_config(self):                # 保存配置文件
```

---

## 6. 数据模型

### 6.1 ScanItem - 扫描项目

文件: `src/core/models.py`

```python
class ScanItem:
    """扫描项目数据模型"""

    属性:
        path: str              # 文件/文件夹路径
        size: int              # 大小（字节）
        item_type: str          # 'file' 或 'directory'
        description: str        # 描述
        risk_level: RiskLevel  # 风险级别
        annotation: ScanAnnotation  # 扫描标注
        last_modified: str     # 最后修改时间
        judgment_method: str   # 判断方法 ('rule' 或 'ai')
        ai_explanation: str    # AI说明文字
```

### 6.2 RiskLevel - 风险级别枚举

文件: `src/core/annotation.py`

```python
class RiskLevel(Enum):
    SAFE = "safe"              # 可安全删除
    SUSPICIOUS = "suspicious"  # 需用户确认
    DANGEROUS = "dangerous"    # 不建议删除
```

### 6.3 MigrationItem - 迁移项目

文件: `src/core/appdata_migration.py`

```python
class MigrationItem:
    """迁移项目数据模型"""

    属性:
        name: str           # 文件夹名称
        path: str           # 源路径
        size: int           # 大小（字节）
        app_type: str       # 应用类型
        category: str       # 数据类别
        risk_level: str     # 风险级别 ('safe', 'wary', 'dangerous')
```

---

## 7. API接口

### 7.1 扫描器API

```python
# 导入扫描器
from core import SystemScanner, BrowserScanner, AppDataScanner, CustomScanner

# 创建扫描器实例
system_scanner = SystemScanner()
browser_scanner = BrowserScanner()
appdata_scanner = AppDataScanner()
custom_scanner = CustomScanner()

# 连接信号
scanner.item_found.connect(on_item_found)
scanner.progress.connect(on_progress)
scanner.error.connect(on_error)
scanner.complete.connect(on_complete)

# 启动扫描
scanner.start_scan(scan_types)

# 取消扫描
scanner.cancel_scan()
```

### 7.2 清理器API

```python
# 导入清理器
from core import Cleaner

# 创建清理器
cleaner = Cleaner()

# 连接信号
cleaner.progress.connect(on_progress)
cleaner.item_deleted.connect(on_item_deleted)
cleaner.error.connect(on_error)
cleaner.complete.connect(on_complete)

# 执行清理
cleaner.start_clean(items, clean_type='system')

# 取消清理
cleaner.cancel_clean()
```

### 7.3 配置管理API

```python
# 导入配置管理器
from core.config_manager import get_config_manager

# 获取配置管理器实例
config_mgr = get_config_manager()

# 读取配置
notification_enabled = config_mgr.get('notification/enabled', True)
tray_enabled = config_mgr.get('system_tray/enabled', True)

# 保存配置
config_mgr.set('notification/enabled', False)
config_mgr.set('cleanup/confirm_dialog', True)

# AI配置操作
ai_config = config_mgr.get_ai_config()
config_mgr.set_ai_config(enabled=True, api_url='...', api_key='...', api_model='...')
```

### 7.4 AppData迁移API

```python
# 导入迁移工具
from core.appdata_migration import AppDataMigrationTool, ScanMigrationThread, MigrateThread

# 创建迁移工具
tool = AppDataMigrationTool()

# 获取可用磁盘
drives = tool.get_available_drives()
# 返回: [{'drive': 'C:', 'total': x, 'free': y}, ...]

# 扫描大型文件夹
thread = ScanMigrationThread(min_size_mb=100)
thread.item_found.connect(on_item_found)
thread.scan()

# 迁移文件夹
thread = MigrateThread(source_path, target_path)
thread.start()

# 回滚迁移
thread = RollbackThread(record)
thread.start()
```

---

## 8. 配置管理

### 8.1 配置文件位置

| 配置类型 | 文件路径 | 用途 |
|---------|---------|------|
| 应用配置 | `src/purifyai_config.json` | 主应用配置 |
| 用户设置 | 同上 | 用户个性化设置 |
| 白名单 | `src/data/whitelist.json` | 扫描排除路径 |
| 数据库 | `src/data/purifyai.db` | 扫描历史记录 |

### 8.2 配置项说明

#### notification (通知设置)
- `enabled`: 是否启用通知 (默认: true)

#### system_tray (系统托盘)
- `enabled`: 是否启用托盘 (默认: true)
- `minimize`: 是否最小化到托盘 (默认: true)
- `minimize_on_close`: 关闭时是否最小化 (默认: false)

#### startup (开机启动)
- `enabled`: 是否开机启动 (默认: false)

#### cleanup (清理设置)
- `confirm_dialog`: 删除前确认 (默认: true)

#### scheduler (调度器)
- `type`: 调度类型 (0=禁用, 1=每日定时, 2=磁盘空间)
- `daily_time`: 每日定时时间 (格式: HH:MM)
- `disk_threshold`: 磁盘空间阈值 (GB)

#### recycle (回收站)
- `enabled`: 是否启用回收站功能 (默认: false)
- `folder_path`: 回收站文件夹路径

#### ai (AI设置)
- `enabled`: 是否启用AI评估 (默认: false)
- `api_url`: API地址
- `api_key`: API密钥
- `api_model`: AI模型名称

#### appdata_migration (AppData迁移)
- `enabled`: 是否启用迁移功能 (默认: false)

#### developer_console (开发者控制台)
- `enabled`: 是否显示开发者控制台 (默认: false)

---

## 9. 数据库结构

### 9.1 数据库文件

- **文件位置**: `src/data/purifyai.db`
- **数据库类型**: SQLite3

### 9.2 数据表结构

#### cleanup_history (清理历史表)

```sql
CREATE TABLE cleanup_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    clean_type TEXT NOT NULL,              -- 清理类型: system/browser/custom
    items_count INTEGER NOT NULL,          -- 清理项数量
    total_size INTEGER NOT NULL,           -- 清理总大小(字节)
    duration_ms INTEGER NOT NULL,         -- 耗时(毫秒)
    timestamp_scanned_at TEXT,            -- 扫描时间
    timestamp_cleaned_at TEXT NOT NULL,    -- 清理时间
    details TEXT,                         -- 详细信息JSON
    created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

#### cleaned_items (清理项目记录表)

```sql
CREATE TABLE cleaned_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    history_id INTEGER NOT NULL,         -- 关联cleanup_history.id
    path TEXT NOT NULL,                    -- 文件路径
    size INTEGER NOT NULL,                 -- 文件大小
    risk_level TEXT,                       -- 风险级别
    deleted_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (history_id) REFERENCES cleanup_history(id)
);
```

### 9.3 数据库API

文件: `src/core/database.py`

```python
class Database:
    """数据库操作类"""

    def save_cleanup_history(self, clean_type, items, total_size, duration, details):
        """保存清理历史"""

    def get_cleanup_history(self, limit=50):
        """获取清理历史"""

    def get_clean_stats_by_date_range(self, start_date, end_date):
        """按日期范围获取统计"""

    def get_total_cleaned_size(self):
        """获取总清理大小"""
```

---

## 10. 依赖清单

### 10.1 requirements.txt

```
# 核心UI框架
PyQt5>=5.15.0
PyQt5-Qt5>=5.15.0
PyQt5-sip>=12.8.0

# Fluent UI组件
qfluentwidgets>=1.0.0

# 系统工具
psutil>=5.9.0

# 安全删除
send2trash>=1.8.0
```

### 10.2 依赖说明

| 依赖 | 版本 | 用途 |
|------|------|------|
| PyQt5 | 5.15.0+ | GUI框架 |
| QFluentWidgets | 1.0.0+ | Fluent设计组件 |
| psutil | 5.9.0+ | 系统监控和进程管理 |
| send2trash | 1.8.0+ | 安全删除文件到回收站 |

### 10.3 内置依赖（无需安装）

- SQLite3 - 数据库
- logging - 日志系统
- json - JSON处理
- pathlib - 路径处理
- threading - 多线程支持

---

## 11. 安装与部署

### 11.1 环境要求

- Python 3.14+
- Windows 7/8/10/11
- 管理员权限（某些操作需要）

### 11.2 安装步骤

```bash
# 1. 克隆或下载项目
cd G:\docker\diskclean

# 2. 创建虚拟环境（推荐）
python -m venv venv
.\venv\Scripts\activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 运行应用
cd src
python main.py
```

### 11.3 打包部署

使用 PyInstaller 打包：

```bash
# 安装 PyInstaller
pip install pyinstaller

# 打包
pyinstaller --onefile --windowed \
    --name PurifyAI \
    --icon=app_icon.ico \
    src/main.py

# 输出: dist/PurifyAI.exe
```

---

## 12. 开发指南

### 12.1 代码规范

- 遵循 PEP 8 规范
- 使用类型注解（type hints）
- 添加完整的文档字符串
- 使用 logging 模块记录日志

### 12.2 信号连接规范

```python
# 正确的信号连接方式
self.scanner.item_found.connect(self.on_item_found)
self.scanner.complete.connect(self.on_scan_complete)

# 信号处理函数命名规范
def on_scan_complete(self, results):
    """扫描完成处理"""
    pass
```

### 12.3 线程操作规范

所有耗时操作应在工作线程中执行：

```python
class ScanThread(QThread):
    """扫描线程"""

    progress = pyqtSignal(int, int)
    item_found = pyqtSignal(object)
    complete = pyqtSignal(list)

    def run(self):
        # 执行扫描操作
        for item in items:
            self.item_found.emit(item)

        self.complete.emit(results)
```

### 12.4 错误处理规范

```python
from core.error_handler import catch_errors, logger

@catch_errors
def some_function():
    """自动错误处理"""
    pass
```

### 12.5 日志规范

```python
from utils.logger import get_logger

logger = get_logger(__name__)

logger.debug("调试信息")
logger.info("一般信息")
logger.warning("警告信息")
logger.error("错误信息")
logger.critical("严重错误")
```

---

## 13. 测试指南

### 13.1 测试项目

| 测试项 | 测试方法 | 预期结果 |
|--------|---------|---------|
| 应用启动 | 运行 main.py | 主窗口正常显示 |
| 系统扫描 | 选择扫描类型并扫描 | 正确扫描并显示结果 |
| 浏览器扫描 | 选择浏览器并扫描 | 正确扫描缓存文件 |
| AppData扫描 | 选择AppData并扫描 | 正确扫描应用数据 |
| 清理操作 | 选择项目并清理 | 文件被清理，历史记录保存 |
| 设置保存 | 修改设置后重启 | 设置被正确保存 |
| 系统托盘 | 最小化到托盘 | 应用隐藏到托盘 |
| AppData迁移 | 执行迁移（需admin） | 迁移成功，符号链接创建 |

### 13.2 测试命令

```bash
# 运行应用
cd src
python main.py

# 运行模块测试
python -m pytest tests/

# 代码检查
flake8 src/
```

---

## 14. 常见问题

### Q1: 应用无法启动

**排查步骤:**
1. 检查 Python 版本是否 >= 3.14
2. 检查是否安装所有依赖
3. 查看日志文件中的错误信息

### Q2: 扫描时出现权限错误

**解决方案:**
- 以管理员身份运行应用
- 检查文件权限设置

### Q3: 清理操作失败

**排查步骤:**
1. 检查文件是否被占用（使用进程检测）
2. 尝试使用管理员权限
3. 检查磁盘空间

### Q4: AppData迁移失败

**原因:**
- 缺少管理员权限（mklink需要）
- 目标磁盘空间不足
- 相关进程未停止

**解决方案:**
- 以管理员身份运行
- 检查目标磁盘空间
- 手动停止相关进程

---

## 附录

### A. 关键文件索引

| 文件 | 行数 | 功能 |
|------|------|------|
| `src/main.py` | 65 | 应用入口 |
| `src/app.py` | 370+ | 主应用类 |
| `src/core/scanner.py` | 200+ | 扫描器实现 |
| `src/core/cleaner.py` | 150+ | 清理器实现 |
| `src/core/rule_engine.py` | 100+ | 规则引擎 |
| `src/ui/system_cleaner.py` | 2000+ | 系统清理UI |
| `src/ui/browser_cleaner.py` | 400+ | 浏览器清理UI |
| `src/ui/settings.py` | 580+ | 设置页面 |

### B. 功能开关配置

| 功能开关 | 配置路径 | 默认值 |
|---------|---------|--------|
| 通知功能 | `notification/enabled` | true |
| 系统托盘 | `system_tray/enabled` | true |
| 开机启动 | `startup/enabled` | false |
| 自动清理 | `scheduler/type` | 0 (禁用) |
| 回收站功能 | `recycle/enabled` | false |
| AI评估 | `ai/enabled` | false |
| AppData迁移 | `appdata_migration/enabled` | false |

### C. 联系方式

项目维护: [填写维护者信息]
问题反馈: [填写反馈渠道]

---

**文档版本**: v1.0
**最后更新**: 2026-02-21
